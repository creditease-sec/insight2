webpackJsonp([21],{CHaj:function(t,e){},ru0D:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("INCx"),s=i.n(a),n=(i("7+uW"),i("X2Oc")),r=i("diDo"),o={name:"curd",components:{},data:function(){return{cur_audit_status:"/auditing/confirm",auditVisible:!1,solveVisible:!1,select_vul_status:null,app_id:null,app_id_name:null,status_options:[{value:"0",label:"未审核"}],rules:{vul_name:[{required:!0,message:"请输入漏洞标题",trigger:"blur"}],app_id:[{required:!0,message:"请选择关联应用",trigger:"change"}],layer:[{required:!0,message:"请选择漏洞层面",trigger:"blur"}],vul_type:[{required:!0,message:"请选择漏洞类型",trigger:"blur"}],self_rank:[{required:!0,message:"请填写Rank值",trigger:"blur"}],vul_source:[{required:!0,message:"请选择漏洞来源",trigger:"blur"}]},app_list_url:"/api/app/list",paper_list_url:"/api/paper/list",is_report_visible:!1,is_solution_visible:!1,cronPopover:!1,cron:"",rank:0,links:[],task_type:"立即任务",url:"",md_report:"一、URL地址：\n二、发现方式：\n\n\n请尽量详细描述，保留场景/截图/重现方法等 \n\n\n三、漏洞证明：\n\n\n请在这里写POC\n\n\n",form_errors:[],cur_entity:{},add_url:"/api/vul/add",list_url:"/api/vul/open/list",del_url:"/api/vul/del",del_list:new URLSearchParams,tableData:[],select_word:"",cur_page:1,page_size:10,total:0,multipleSelection:[],editVisible:!1,createVisible:!1,form:{self_rank:"1",layer:10,app_id:-1},role_options:[{value:"__",label:"--"}],static_config:r.b}},created:function(){this.getData()},updated:function(){this.$desensitive()},computed:{isShowText:function(){return!this.cur_entity},isShowAuditDetail:function(){return"/auditing/confirm"==this.cur_audit_status},isShowAuditButton:function(){return!!this.cur_entity&&"10"==this.cur_entity.vul_status},isShowConfirmButton:function(){return!!this.cur_entity&&"40"==this.cur_entity.vul_status},isShowApplyRetestButton:function(){return!!this.cur_entity&&"50"==this.cur_entity.vul_status},isShowSubmitRetestButton:function(){return!!this.cur_entity&&"55"==this.cur_entity.vul_status},colortype:function(){return this.form.self_rank>=0&&this.form.self_rank<6?"success":this.form.self_rank<11?"":this.form.self_rank<16?"danger":this.form.self_rank<=20?"warning":void 0},risklevel:function(){return this.form.self_rank>=0&&this.form.self_rank<6?"低危":this.form.self_rank<11?"中危":this.form.self_rank<16?"高危":this.form.self_rank<=20?"严重":void 0},real_risklevel:function(){return this.form.real_rank>=0&&this.form.real_rank<6?"低危":this.form.real_rank<11?"中危":this.form.real_rank<16?"高危":this.form.real_rank<=20?"严重":void 0}},filters:{getDateDiff_timestamp:function(t){return Object(n.e)(t)},formatDate:function(t){var e=new Date(s()(1e3*t));return Object(n.c)(e,"yyyy-MM-dd HH:mm:ss")},statusFilter:function(t){return{0:"info",1:"success","-1":"danger"}[t]},statusNameFilter:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"其他";r.b[e][t];return r.b[e][t]?r.b[e][t]:i}},methods:{exportCSV:function(){this.$axios({method:"get",url:"/api/vul/export",data:{search:this.select_word,page_index:this.cur_page,page_size:this.page_size,sort:this.sortcolumn,direction:this.sortorder,vul_status:this.select_vul_status},responseType:"blob"}).then(function(t){if(t.data){var e=window.URL.createObjectURL(t.data),i=document.createElement("a");i.style.display="none",i.href=e,i.setAttribute("download","vulns_export.csv"),document.body.appendChild(i),i.click()}})},updateCur_entity:function(){this.form=this.cur_entity,this.form.vul_type=this.cur_entity.vul_type.toString()},statusColor:function(t){return Object(n.g)(t)},rankColor:function(t){return Object(n.f)(t)},pocChange:function(t,e){this.form.vul_poc_html=e},solutionChange:function(t,e){this.form.vul_solution_html=e},$imgAdd:function(t,e){var i=this,a=new FormData;a.append("image",e),this.$axios({url:"/api/image/upload",method:"post",data:a,headers:{"Content-Type":"multipart/form-data"}}).then(function(e){console.log(e),i.$refs.poc_editor.$img2Url(t,"api/"+e.data.path)})},$imgAddSolution:function(t,e){var i=this,a=new FormData;a.append("image",e),this.$axios({url:"/api/image/upload",method:"post",data:a,headers:{"Content-Type":"multipart/form-data"}}).then(function(e){console.log(e),i.$refs.solution_editor.$img2Url(t,"api/"+e.data.path)})},handleSelect:function(t){this.form.app_id=t.id,this.form.app_name=t.value},handleSelectPaper:function(t){this.form.solution_id=t.id,this.form.solution_name=t.value},querySearchAsync:function(t,e){this.$axios.get(this.app_list_url,{params:{search:t}}).then(function(t){var i=new Array;t.data.result.map(function(t){i.push({value:t.appname,id:t.id.toString()})}),e(i)})},querySearchPaperAsync:function(t,e){this.$axios.get(this.paper_list_url,{params:{search:t}}).then(function(t){var i=new Array;t.data.result.map(function(t){i.push({value:t.title,id:t.id})}),e(i)})},handleClose:function(t){this.$confirm("数据还未提交，确认关闭？").then(function(e){t()}).catch(function(t){})},sortChange:function(t,e,i){this.sortcolumn=t.prop,this.sortorder=t.order,this.getData()},viewUser:function(){if(console.log(this.cur_entity),this.cur_entity.id){var t=this.$router.resolve({name:"n_viewvulndetail",query:{id:this.cur_entity.id}});window.open(t.href,"_blank")}else this.$message.info("请选择数据")},doCreate:function(t){var e=this;(this.$refs.createForm?this.$refs.createForm:this.$refs.editForm).validate(function(t){t?e.$axios.post(e.add_url,Object(n.h)(e.form)).then(function(t){1==t.data.status?(e.$message.success("操作成功"),e.getData()):e.$message.error("操作失败, 错误码:"+t.data.status+t.data.msg),e.createVisible=!1,e.editVisible=!1}):e.$message.error("提交失败，请填写相应信息")})},doAudit:function(t){var e=this;this.$axios.post("api/"+this.cur_audit_status,Object(n.h)(this.form)).then(function(t){1==t.data.status?(e.$message.success("操作成功"),e.getData()):e.$message.error("操作失败, 错误码:"+t.data.status+t.data.msg),e.auditVisible=!1})},doSolve:function(t){var e=this;this.$axios.post("api/"+this.cur_audit_status,Object(n.h)(this.form)).then(function(t){1==t.data.status?(e.$message.success("操作成功"),e.getData()):e.$message.error("操作失败, 错误码:"+t.data.status+t.data.msg),e.solveVisible=!1})},getData:function(){var t=this;this.$axios.get(this.list_url,{params:{search:this.select_word,page_index:this.cur_page,page_size:this.page_size,sort:this.sortcolumn,direction:this.sortorder,vul_status:this.select_vul_status}}).then(function(e){t.tableData=e.data.result,t.total=e.data.total})},handleSizeChange:function(t){this.page_size=t,this.getData()},handleCurrentChange:function(t){this.cur_page=t,this.getData()},handleCurrentChangeRow:function(t){this.cur_entity=t},search:function(){this.getData()},handleEdit:function(t,e){this.form_errors=[],this.editVisible=!0,this.form=e,delete this.form.create_time,this.form.enable=1==e.enable?"1":"0",this.form.app_name=e.appname,this.form.vul_type=e.vul_type.toString()},handleSelectionChange:function(t){this.multipleSelection=t},dataDel:function(t){var e=this,i=null;if(t)i=t;else{if(this.multipleSelection.length<=0)return void this.$message.info("未选择任何数据");this.del_list=this.multipleSelection.map(function(t){return t.id}),i=this.del_list}this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){e.$axios.post(e.del_url,Object(n.h)({id:i})).then(function(t){t.data.status>=1?(e.getData(),e.$message.success("删除成功")):e.$message.error("删除失败, 错误码: "+t.data.status)})}).catch(function(){})},filterVulType:function(t,e,i){return console.log(t,e,i),e[i.property]===t}}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-tickets"}),t._v(" 漏洞\n      ")]),t._v(" "),i("el-breadcrumb-item",[t._v("公开漏洞")])],1)],1),t._v(" "),i("div",{staticClass:"container"},[i("div",{staticClass:"handle-box"},[i("el-input",{staticClass:"handle-input",attrs:{size:"mini",placeholder:"请输入关键词"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search()}},model:{value:t.select_word,callback:function(e){t.select_word=e},expression:"select_word"}}),t._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),i("div",{staticStyle:{float:"right"}},[i("span",{directives:[{name:"show",rawName:"v-show",value:t.isShowText,expression:"isShowText"}],staticStyle:{"font-weight":"400",color:"#606266","font-size":"13px"}},[t._v(" 请选择一条数据以显示可操作项")])])],1),t._v(" "),i("el-table",{attrs:{data:t.tableData,border:"","highlight-current-row":""},on:{"selection-change":t.handleSelectionChange,"current-change":t.handleCurrentChangeRow,"sort-change":t.sortChange}},[i("el-table-column",{attrs:{prop:"vul_name",label:"名称","min-width":"150",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"primary-title insight_sensitive",staticStyle:{cursor:"pointer !important"},on:{click:function(i){t.cur_entity=e.row,t.viewUser()}}},[t._v(t._s(e.row.vul_name))])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"vul_type",label:"类型","min-width":"100",filters:[{text:"弱口令",value:"10"},{text:"SQL注入漏洞",value:"120"}],"filter-method":t.filterVulType,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"in-tag",style:{color:t.statusColor(e.row.vul_type)}},[t._v(t._s(t._f("statusNameFilter")(e.row.vul_type,"VUL_TYPE"))+" ")])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"self_rank",label:"Rank","min-width":"70",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{style:{color:t.rankColor(e.row.self_rank),"font-weight":"bold"}},[t._v(t._s(e.row.self_rank))])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"username",label:"提交人","min-width":"100",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"insight_sensitive"},[t._v("\n            "+t._s(e.row.username)+"\n          ")])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"",label:"提交时间","min-width":"80",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tooltip",{attrs:{effect:"light",content:t._f("formatDate")(e.row.submit_time),placement:"right"}},[i("span",[t._v(t._s(t._f("getDateDiff_timestamp")(e.row.submit_time)))])])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"vul_status",label:"状态","min-width":"70",filters:[{text:"弱口令",value:"10"},{text:"SQL注入漏洞",value:"120"}],"filter-method":t.filterVulType,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"in-tag",style:{color:t.statusColor(e.row.vul_status)}},[t._v(t._s(t._f("statusNameFilter")(e.row.vul_status,"VUL_STATUS","未处理")))])]}}])})],1),t._v(" "),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{"current-page":t.cur_page,"page-sizes":[10,20,50,100],"page-size":t.page_size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.cur_page=e},"update:current-page":function(e){t.cur_page=e},"update:pageSize":function(e){t.page_size=e},"update:page-size":function(e){t.page_size=e},"update:total":function(e){t.total=e}}})],1)],1)])},staticRenderFns:[]};var u=i("VU/8")(o,l,!1,function(t){i("CHaj")},"data-v-59f81614",null);e.default=u.exports}});